<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ugotfilm.choice.dao.ChoiceDAO">
	<!-- 유저의 정보로도 구분하여 클릭수 정보를 group by 하여 가져올 수 있음(연령대, 성별) -->

	<!-- 성별에 따른 영화 리스트 -->
	<select id="gender" parameterType="int" resultType="MovieDTO">
		SELECT m.*
		FROM (
		SELECT b.moviecode, count(b.moviecode) AS count
		FROM
		UGOTFILM_USER a, UGOTFILM_MOVIE_CHOICE b
		WHERE a.usercode = b.usercode
		AND a.gender = (SELECT gender FROM UGOTFILM_USER WHERE usercode=
		#{usercode})
		GROUP BY b.moviecode) g
		LEFT JOIN UGOTFILM_MOVIE m ON
		m.moviecode = g.moviecode ORDER BY count
		desc
	</select>

	<select id="genre" parameterType="int" resultType="GenreDTO">
		<![CDATA[
		select * from
		(
		select g.name, u.* from (
		select genrecode, count(genrecode) as count
		from ugotfilm_genre_choice
		where usercode= #{usercode}
		group by genrecode) u
		left join ugotfilm_genre g on g.genrecode=u.genrecode
		order by count desc)
		where rownum < 2
		]]>
	</select>


	<!-- 영화 정보가 있는지 체크하는 쿼리 -->
	<select id="exist" resultType="int">
		SELECT count(*) FROM
		ugotfilm_MOVIE where MOVIECODE=#{MOVIECODE}
	</select>

	<!-- 영화 정보를 저장하는 쿼리 -->
	<insert id="savemovieinfo" parameterType="MovieDTO">
		INSERT INTO
		ugotfilm_MOVIE(MOVIECODE, TITLE, OVERVIEW, RELEASE_date, VOTE_verage,
		genre_ids, POSTER_URL)
		VALUES(#{MOVIECODE}, #{TITLE}, #{OVERVIEW},
		#{RELEASE_date}, #{VOTE_verage}, #{genre_ids}, #{POSTER_URL})
	</insert>


	<!-- 유저 추가한 북마크 저장 쿼리 -->
	<insert id="savebookmark" parameterType="int">
		insert INTO
		ugotfilm_bookmark VALUES (#{usercode}, #{movicecode}, sysdate);
	</insert>


	<!-- 선호도 정보 추가 -->
	<!-- 유저가 선택한 영화를 저장하는 쿼리 -->
	<insert id="moviechoice" parameterType="int">
		insert INTO
		ugotfilm_movie_choice VALUES (#{usercode}, #{movicecode}, sysdate);
	</insert>





</mapper>